<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App TDAH</title>
  <link rel="stylesheet" href="css/styles1.css">

  <!-- Firebase SDKs: Cargados con las versiones de compatibilidad para exponer el objeto global 'firebase' -->
  <!-- Esto evita los problemas de 'import'/'export' cuando no se cargan como mÃ³dulos ES -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <!-- Si usas Analytics, descomenta la lÃ­nea de abajo -->
  <!-- <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script> -->

</head>
<body>
  <div class="container">

    <header>
      <h1>ğŸ§  TDAH Helper App</h1>
      <p>Tu asistente personal para organizaciÃ³n y productividad</p>
      <!-- user-info-area: Se ajustarÃ¡ dinÃ¡micamente para centrar los botones cuando no hay sesiÃ³n -->
      <div id="user-info-area" style="font-size: 0.8em; color: var(--text-light); margin-top: 10px; display: flex; align-items: center; flex-wrap: wrap;">
        <span id="user-display-name">Cargando usuario...</span>
        <div class="auth-buttons-wrapper"> <!-- Nuevo wrapper para los botones -->
            <button id="google-signin-btn" class="button-primary auth-btn" style="display: none;">
              <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google logo" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 8px;">
              Iniciar con Google
            </button>
            <button id="email-signin-toggle-btn" class="button-secondary auth-btn" style="display: none;">
              Iniciar con Email
            </button>
            <button id="anonymous-signin-btn" class="button-secondary auth-btn" style="display: none;">
              Continuar como AnÃ³nimo
            </button>
        </div>
        <button id="logout-btn" class="button-secondary" style="display: none;">Cerrar SesiÃ³n</button>
      </div>
    </header>

    <!-- Formulario de inicio de sesiÃ³n/registro con Email -->
    <div id="email-auth-form" class="auth-form-card" style="display: none; margin-top: 20px; padding: 20px; border-radius: 8px; background-color: #f9f9f9; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
      <h3>Iniciar SesiÃ³n / Registrarse con Email</h3>
      <input type="email" id="email-input" placeholder="Correo electrÃ³nico" style="width: calc(100% - 20px); padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
      <input type="password" id="password-input" placeholder="ContraseÃ±a" style="width: calc(100% - 20px); padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px;">
      <button id="email-signup-btn" class="button-primary" style="margin-right: 10px;">Registrarse</button>
      <button id="email-login-btn" class="button-secondary">Iniciar SesiÃ³n</button>
      <button id="email-form-close-btn" class="button-danger" style="float: right;">X</button>
    </div>

    <div class="nav-tabs">
      <button id="btn-pomodoro" class="active">â±ï¸ Pomodoro</button>
      <button id="btn-tareas">ğŸ“‹ Tareas Importantes</button>
      <button id="btn-checklist">âœ… Checklist RÃ¡pido</button>
      <button id="btn-journal">ğŸ“ Journal</button>
      <button id="btn-notas">ğŸ“ Notas Blog</button>
      <button id="btn-nutricion">ğŸ NutriciÃ³n</button> <!-- Nuevo botÃ³n para NutriciÃ³n -->
      <button id="btn-config">âš™ï¸ ConfiguraciÃ³n</button>
    </div>

    <section id="pomodoro" class="seccion active">
      <h2>â±ï¸ Temporizador Pomodoro</h2>
      <div id="timer">25:00</div>
      <div class="pomodoro-buttons">
        <button id="start-timer-btn">â–¶ï¸ Iniciar</button>
        <button id="pause-pomodoro-btn">â¸ï¸ Pausar</button>
        <button id="reset-timer-btn">ğŸ”„ Resetear</button>
      </div>
      <div class="help-text">
        ğŸ’¡ 25 min de trabajo concentrado + 5 min de descanso. Â¡Perfecto para TDAH!
      </div>
    </section>

    <section id="tareas" class="seccion">
      <h2>ğŸ“‹ Tareas Importantes (Trello)</h2>
      <div id="trello-status" class="status-indicator status-disconnected">
        âŒ Trello no conectado
      </div>
      <div id="tareas-content">
        <p>Configura tu conexiÃ³n a Trello para ver las tareas que vencen hoy.</p>
        <button id="config-trello-btn">âš™ï¸ Configurar Trello</button>
      </div>
      <ul id="listaTareas"></ul>
    </section>

    <section id="checklist" class="seccion">
      <h2>âœ… Checklist RÃ¡pido</h2>
      <div class="mit-explanation">
        <p>La clave es no abrumarse. Al inicio de cada dÃ­a, identifica las <strong>3 tareas mÃ¡s importantes (MITs - Most Important Tasks)</strong>. Si terminas esas, puedes pasar a otras, pero el objetivo es asegurar lo crucial.</p>
        <p>Marca hasta 3 tareas como MITs usando la casilla "MIT". Estas se destacarÃ¡n con un color especial. Â¡Puedes aÃ±adir mÃ¡s tareas en cualquier momento!</p>
      </div>
      <div class="input-group">
        <input type="text" id="checkItem" placeholder="Nuevo Ã­tem del checklist..." />
        <button id="add-check-item-btn">â• Agregar</button>
      </div>
      <ul id="checkList"></ul>
      <div class="help-text">
        ğŸ’¡ Para tareas pequeÃ±as y recordatorios rÃ¡pidos del dÃ­a
      </div>
    </section>

    <section id="journal" class="seccion">
        <h2>ğŸ“ Journal</h2>
        <p class="subtitle">Un espacio reflexivo para documentar emociones, actividades y situaciones significativas de tu jornada, fomentando el autoconocimiento y el bienestar.</p>
        <textarea id="journalEntry" rows="10" placeholder="Escribe aquÃ­ tu entrada del diario..."></textarea>
        <button id="save-journal-entry-btn">Guardar Entrada</button>

        <h3>Entradas Anteriores:</h3>
        <ul id="journalEntriesList">
            <!-- Las entradas del diario se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
        </ul>
    </section>

    <section id="notas" class="seccion">
      <h2>ğŸ“ Notas de Blog TDAH</h2>
      <div id="blog-content">
        <p>Cargando artÃ­culos sobre TDAH...</p>
        </div>
      <button id="refresh-blog-btn">ğŸ”„ Actualizar ArtÃ­culos</button>
    </section>

    <section id="nutricion" class="seccion">
        <h2>ğŸ NutriciÃ³n y Recetas</h2>
        <div id="nutricion-content">
            <p>Cargando recomendaciones nutricionales y recetas...</p>
            </div>
        <button id="refresh-nutricion-btn">ğŸ”„ Actualizar Contenido</button>
    </section>

    <section id="config" class="seccion">
      <h2>âš™ï¸ ConfiguraciÃ³n</h2>
      
      <div class="config-card" id="config-card">
        <h3>ğŸ”— Conectar con Trello</h3>
        
        <div class="config-step">
          <label for="api-key">API Key de Trello:</label>
          <input type="text" id="api-key" placeholder="Pega aquÃ­ tu API Key...">
          <div class="help-text">
            ğŸ“ ObtÃ©n tu API Key en: <a href="https://trello.com/app-key" target="_blank">https://trello.com/app-key</a>
          </div>
        </div>

        <div class="config-step">
          <label for="token">Token de Trello:</label>
          <input type="text" id="token" placeholder="Pega aquÃ­ tu Token...">
          <div class="help-text">
            ğŸ“ Genera tu Token clickeando en el link que aparece junto a tu API Key
          </div>
        </div>

        <div class="config-step">
          <label for="board-id">ID del Board:</label>
          <input type="text" id="board-id" placeholder="ID de tu board de Trello...">
          <div class="help-text">
            ğŸ“ Encuentra el ID en la URL de tu board: trello.com/b/<strong>ID_AQUI</strong>/nombre-board
          </div>
        </div>

        <button id="test-trello-btn">ğŸ” Probar ConexiÃ³n</button>
        <button id="save-trello-config-btn">ğŸ’¾ Guardar ConfiguraciÃ³n</button>
        
        <div class="success-message" id="trello-success-message">
          âœ… Â¡ConexiÃ³n exitosa! Ya puedes ver tus tareas de Trello.
        </div>
      </div>

      <div class="config-card">
        <h3>ğŸ“Š Estado de la App</h3>
        <p><strong>Tareas guardadas:</strong> <span id="tasks-count">0</span></p>
        <p><strong>Checklist items:</strong> <span id="checklist-count">0</span></p>
        <p><strong>Ãšltima sincronizaciÃ³n Trello:</strong> <span id="last-sync">Nunca</span></p>
        
        <button id="clear-data-btn" style="background: #ef4444;">ğŸ—‘ï¸ Limpiar Todos los Datos</button>
      </div>
    </section>
  </div>

  <div id="confetti-container"></div> <!-- Contenedor para el confeti -->
  <div id="temp-message-container"></div>
  <!-- AÃ±adir onerror para depurar problemas de carga de audio -->
  <audio id="sound-complete" src="sounds/complete.mp3" preload="auto" onerror="console.error('Error cargando sound-complete.mp3'); window.showTempMessage('Error: No se pudo cargar el sonido de finalizaciÃ³n.', 'error', 5000);"></audio>
  <audio id="sound-break" src="sounds/break.mp3" preload="auto" onerror="console.error('Error cargando sound-break.mp3'); window.showTempMessage('Error: No se pudo cargar el sonido de descanso.', 'error', 5000);"></audio>
  <audio id="sound-task-done" src="sounds/task-done.mp3" preload="auto" onerror="console.error('Error cargando sound-task-done.mp3'); window.showTempMessage('Error: No se pudo cargar el sonido de tarea completada.', 'error', 5000);"></audio>

  <!-- Div de prueba para verificar si el CSS se carga correctamente -->
  <div id="css-check" style="position: fixed; top: 10px; right: 10px; width: 20px; height: 20px; background-color: red; border-radius: 50%;"></div>

  <!-- Custom Confirmation Modal HTML -->
  <div id="custom-confirm-modal" class="custom-modal-overlay" style="display: none;">
    <div class="custom-modal-content">
      <p id="custom-confirm-message"></p>
      <div class="modal-buttons">
        <button id="custom-confirm-yes">SÃ­</button>
        <button id="custom-confirm-no">No</button>
      </div>
    </div>
  </div>


  <!-- Script de inicializaciÃ³n de Firebase y autenticaciÃ³n -->
  <!-- Este script se ejecuta despuÃ©s de que los SDK de Firebase se han cargado (en el head) -->
  <!-- y antes de main.js, asegurando que 'firebase' estÃ© definido. -->
  <script>
    console.log("Script inline en body: Iniciando configuraciÃ³n de Firebase.");
    // ConfiguraciÃ³n de Firebase proporcionada por el usuario
    // Â¡IMPORTANTE! Reemplaza estos valores con los de TU proyecto de Firebase
    // EncuÃ©ntralos en la Consola de Firebase > ConfiguraciÃ³n del proyecto > Tus apps (aplicaciÃ³n web)
    const firebaseConfig = {
        apiKey: "AIzaSyAaC7FvY_9bDHBvl36YWAIIO9qXyvqZrUw", // <--- VERIFICA ESTE VALOR
        authDomain: "tdah-app-efca9.firebaseapp.com",    // <--- VERIFICA ESTE VALOR
        projectId: "tdah-app-efca9",                     // <--- VERIFICA ESTE VALOR
        storageBucket: "tdah-app-efca9.firebasestorage.app",
        messagingSenderId: "765424031369",
        appId: "1:765424031369:web:838eca686f68f21daa5858",
        measurementId: "G-QY7X98XZZV"
    };

    // Inicializar Firebase y exponer a window para main.js
    // Usamos las funciones de la API global de Firebase (v8 compat)
    window.firebaseApp = firebase.initializeApp(firebaseConfig);
    window.db = firebase.firestore(); // Acceder a Firestore
    window.auth = firebase.auth();   // Acceder a Auth

    // Asegurarse de usar el appId de la configuraciÃ³n de Firebase
    window.appId = firebaseConfig.appId;
    // __initial_auth_token es una variable global proporcionada por el entorno Canvas
    window.initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    console.log("Script inline en body: Firebase inicializado y variables expuestas.");

    // Funciones globales que main.js tambiÃ©n podrÃ­a necesitar o que el HTML llama directamente
    // Definirlas aquÃ­ para asegurar que estÃ©n disponibles cuando DOMContentLoaded se dispare.
    window.mostrarSeccion = function(idSeccion) {
        console.log(`Intentando mostrar secciÃ³n: ${idSeccion}`);
        document.querySelectorAll('.seccion').forEach(seccion => {
            seccion.classList.remove('active');
        });
        document.querySelectorAll('.nav-tabs button').forEach(button => {
            button.classList.remove('active');
        });

        const seccionActiva = document.getElementById(idSeccion);
        if (seccionActiva) {
            seccionActiva.classList.add('active');
            console.log(`SecciÃ³n ${idSeccion} activada.`);
        } else {
            console.warn(`SecciÃ³n con ID ${idSeccion} no encontrada.`);
        }
        const botonActivo = document.getElementById(`btn-${idSeccion}`);
        if (botonActivo) {
            botonActivo.classList.add('active');
            console.log(`BotÃ³n ${idSeccion} activado.`);
        } else {
            console.warn(`BotÃ³n con ID btn-${idSeccion} no encontrado.`);
        }
    };

    window.showTempMessage = function(message, type = 'info', duration = 3000) {
        console.log(`Mostrar mensaje temporal: [${type}] ${message}`);
        const tempMessageContainer = document.getElementById('temp-message-container');
        if (!tempMessageContainer) {
            console.error("Contenedor de mensajes temporales no encontrado.");
            return;
        }
        const msgElement = document.createElement('div');
        msgElement.className = `temp-message ${type}`;
        msgElement.textContent = message;
        tempMessageContainer.appendChild(msgElement);

        msgElement.offsetHeight;
        msgElement.classList.add('show');

        setTimeout(() => {
            msgElement.classList.remove('show');
            msgElement.classList.add('hide');
            msgElement.addEventListener('transitionend', () => msgElement.remove(), { once: true });
        }, duration);
    };

    // FunciÃ³n para disparar el efecto de confeti
    window.triggerConfetti = function() {
        let confettiContainer = document.getElementById('confetti-container');
        if (!confettiContainer) {
            confettiContainer = document.createElement('div');
            confettiContainer.id = 'confetti-container';
            document.body.appendChild(confettiContainer);
        }

        const colors = ['var(--primary-color)', 'var(--secondary-color)', '#FFD700', '#FF69B4', '#00FFFF']; // Colores para el confeti
        const numConfetti = 50; // NÃºmero de piezas de confeti

        for (let i = 0; i < numConfetti; i++) {
            const piece = document.createElement('div');
            piece.className = 'confetti-piece';
            piece.style.left = `${Math.random() * 100}vw`; // PosiciÃ³n horizontal aleatoria
            piece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            piece.style.animationDuration = `${Math.random() * 2 + 3}s`; // DuraciÃ³n aleatoria entre 3-5s
            piece.style.animationDelay = `${Math.random() * 0.5}s`; // Ligero retraso para efecto escalonado
            piece.style.width = `${Math.random() * 8 + 5}px`; // TamaÃ±o aleatorio
            piece.style.height = piece.style.width;
            confettiContainer.appendChild(piece);
        }

        // Limpiar el confeti despuÃ©s de la animaciÃ³n
        setTimeout(() => {
            confettiContainer.innerHTML = ''; // Eliminar todas las piezas
        }, 5000); // Coincide con la duraciÃ³n mÃ¡s larga de la animaciÃ³n
    };

    // Custom Confirmation Modal
    window.showCustomConfirm = function(message) {
        return new Promise((resolve) => {
            const modal = document.getElementById('custom-confirm-modal');
            const msgElement = document.getElementById('custom-confirm-message');
            const yesBtn = document.getElementById('custom-confirm-yes');
            const noBtn = document.getElementById('custom-confirm-no');

            msgElement.textContent = message;
            modal.style.display = 'flex'; // Make it visible (but still transparent/offset)

            // Force reflow to ensure display:flex is applied before adding 'show' class
            // This is crucial for CSS transitions to work from display:none to display:flex
            void modal.offsetWidth; 

            modal.classList.add('show'); // Now add the class that applies opacity and transform

            const cleanup = () => {
                modal.classList.remove('show'); // Start hide transition
                // Wait for the transition to finish before setting display to 'none'
                modal.addEventListener('transitionend', () => {
                    modal.style.display = 'none';
                }, { once: true });
                yesBtn.removeEventListener('click', onYesClick);
                noBtn.removeEventListener('click', onNoClick);
            };

            const onYesClick = () => {
                cleanup();
                resolve(true);
            };

            const onNoClick = () => {
                cleanup();
                resolve(false);
            };

            yesBtn.addEventListener('click', onYesClick);
            noBtn.addEventListener('click', onNoClick);
        });
    };

    // AquÃ­ se eliminÃ³ el listener DOMContentLoaded y el onAuthStateChanged
    // para centralizarlo en main.js.
  </script>

  <!-- main.js se carga al final del body para asegurar que todos los elementos HTML estÃ©n disponibles -->
  <script src="js/main.js"></script>
</body>
</html>


