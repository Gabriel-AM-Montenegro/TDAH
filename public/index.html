<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>App TDAH</title>
  <link rel="stylesheet" href="css/styles1.css">

  <!-- Firebase SDKs: Cargados con las versiones de compatibilidad para exponer el objeto global 'firebase' -->
  <!-- Esto evita los problemas de 'import'/'export' cuando no se cargan como m√≥dulos ES -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"></script>
  <!-- Si usas Analytics, descomenta la l√≠nea de abajo -->
  <!-- <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js"></script> -->

  <style>
    /* Estilo para el div de verificaci√≥n de CSS (eliminar cuando se confirme que el CSS carga) */
    #css-check {
      position: fixed;
      top: 0;
      left: 0;
      width: 10px;
      height: 10px;
      background-color: red; /* Si este color no es visible, el CSS no est√° cargando */
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üß† TDAH Helper App</h1>
      <p>Tu asistente personal para organizaci√≥n y productividad</p>
      <!-- user-info-area: Se ajustar√° din√°micamente para centrar los botones cuando no hay sesi√≥n -->
      <div id="user-info-area" style="text-align: center;">
        <div id="user-display" style="display: none;">
          <span id="user-email"></span>
          <button id="logout-button" class="btn btn-secondary">Cerrar Sesi√≥n</button>
        </div>
        <div id="auth-buttons" style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
          <button id="google-signin-button" class="btn btn-primary">Iniciar con Google</button>
          <button id="anonymous-signin-button" class="btn btn-secondary">Iniciar An√≥nimamente</button>
          <button id="email-signin-button" class="btn btn-tertiary">Iniciar con Email</button>
        </div>
      </div>
    </header>

    <!-- Barra de navegaci√≥n principal -->
    <nav class="main-nav">
      <button id="btn-pomodoro" class="nav-btn active">
        <span class="icon">‚è∞</span> Pomodoro
      </button>
      <button id="btn-checklist" class="nav-btn">
        <span class="icon">‚úÖ</span> Checklist R√°pido
      </button>
      <button id="btn-journal" class="nav-btn">
        <span class="icon">‚úçÔ∏è</span> Journal
      </button>
      <button id="btn-habitos" class="nav-btn">
        <span class="icon">üéØ</span> H√°bitos
      </button>
      <button id="btn-tareas" class="nav-btn">
        <span class="icon">üìã</span> Tareas Trello
      </button>
      <button id="btn-notas" class="nav-btn">
        <span class="icon">üìù</span> Notas Blog
      </button>
      <button id="btn-nutricion" class="nav-btn">
        <span class="icon">üçé</span> Nutrici√≥n
      </button>
      <button id="btn-config" class="nav-btn">
        <span class="icon">‚öôÔ∏è</span> Configuraci√≥n
      </button>
    </nav>

    <main class="content-area">
      <!-- Secci√≥n Pomodoro -->
      <section id="pomodoro" class="content-section active">
        <h2>Temporizador Pomodoro</h2>
        <div class="pomodoro-timer">
          <span id="minutes">25</span>:<span id="seconds">00</span>
        </div>
        <div class="pomodoro-controls">
          <button id="start-pomodoro" class="btn btn-primary">Iniciar</button>
          <button id="pause-pomodoro" class="btn btn-secondary">Pausar</button>
          <button id="reset-pomodoro" class="btn btn-tertiary">Reiniciar</button>
        </div>
        <p id="pomodoro-message" class="message"></p>
      </section>

      <!-- Secci√≥n Checklist R√°pido -->
      <section id="checklist" class="content-section">
        <h2>Checklist R√°pido</h2>
        <div class="input-group">
          <input type="text" id="new-checklist-item" placeholder="Nueva tarea del checklist" />
          <button id="add-checklist-item" class="btn btn-primary">Agregar</button>
        </div>
        <ul id="checklist-items" class="item-list">
          <!-- Los √≠tems del checklist se cargar√°n aqu√≠ -->
        </ul>
      </section>

      <!-- Secci√≥n Journal -->
      <section id="journal" class="content-section">
        <h2>Journal</h2>
        <div class="journal-entry">
          <textarea id="journal-text" placeholder="Escribe tus pensamientos aqu√≠..."></textarea>
          <button id="save-journal-entry" class="btn btn-primary">Guardar Entrada</button>
        </div>
        <div id="journal-entries" class="item-list">
          <!-- Las entradas del journal se cargar√°n aqu√≠ -->
        </div>
      </section>

      <!-- Secci√≥n H√°bitos -->
      <section id="habitos" class="content-section">
        <h2>H√°bitos</h2>
        <div class="input-group">
          <input type="text" id="new-habit-name" placeholder="Nuevo h√°bito" />
          <button id="add-habit" class="btn btn-primary">Agregar H√°bito</button>
        </div>
        <ul id="habit-list" class="item-list">
          <!-- Los h√°bitos se cargar√°n aqu√≠ -->
        </ul>
      </section>

      <!-- Secci√≥n Tareas Trello (o similar) -->
      <section id="tareas" class="content-section">
        <h2>Tareas</h2>
        <p>Aqu√≠ podr√°s integrar o gestionar tus tareas.</p>
        <div class="input-group">
          <input type="text" id="new-task-input" placeholder="A√±adir nueva tarea" />
          <button id="add-task-btn" class="btn btn-primary">A√±adir</button>
        </div>
        <ul id="task-list" class="item-list">
          <!-- Las tareas se cargar√°n aqu√≠ -->
        </ul>
      </section>

      <!-- Secci√≥n Notas Blog -->
      <section id="notas" class="content-section">
        <h2>Notas</h2>
        <div class="input-group">
          <input type="text" id="new-note-title" placeholder="T√≠tulo de la nota" />
          <textarea id="new-note-content" placeholder="Contenido de la nota..."></textarea>
          <button id="add-note" class="btn btn-primary">Guardar Nota</button>
        </div>
        <div id="notes-list" class="item-list">
          <!-- Las notas se cargar√°n aqu√≠ -->
        </div>
      </section>

      <!-- Secci√≥n Nutrici√≥n -->
      <section id="nutricion" class="content-section">
        <h2>Nutrici√≥n</h2>
        <p>Aqu√≠ podr√°s registrar tus comidas y objetivos nutricionales.</p>
        <div class="input-group">
          <input type="text" id="new-food-item" placeholder="Alimento consumido" />
          <button id="add-food-item" class="btn btn-primary">Registrar</button>
        </div>
        <ul id="food-log" class="item-list">
          <!-- El registro de alimentos se cargar√° aqu√≠ -->
        </ul>
      </section>

      <!-- Secci√≥n Configuraci√≥n -->
      <section id="config" class="content-section">
        <h2>Configuraci√≥n</h2>
        <p>Ajustes de la aplicaci√≥n.</p>
        <div class="config-options">
          <button id="request-notification-permission" class="btn btn-primary">
            Solicitar Permiso de Notificaciones
          </button>
          <p id="notification-status">Estado de las notificaciones: Desconocido</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal de confirmaci√≥n personalizado -->
  <div id="custom-confirm-modal" class="custom-modal-overlay">
    <div class="custom-modal-content">
      <p id="custom-confirm-message"></p>
      <div class="modal-buttons">
        <button id="custom-confirm-yes" class="btn btn-primary">S√≠</button>
        <button id="custom-confirm-no" class="btn btn-secondary">No</button>
      </div>
    </div>
  </div>

  <script>
    // Inicializaci√≥n de Firebase (aseg√∫rate de que __firebase_config est√© definido en tu entorno Canvas)
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};

    // Si firebaseConfig est√° vac√≠o, o no tiene projectId, esto podr√≠a indicar un problema de configuraci√≥n en Canvas
    if (!firebaseConfig.projectId) {
        console.error("Firebase: projectId no encontrado en __firebase_config. Aseg√∫rate de que la variable de entorno est√© configurada correctamente.");
        // Opcional: Mostrar un mensaje al usuario en la UI
        document.addEventListener('DOMContentLoaded', () => {
            const authButtons = document.getElementById('auth-buttons');
            if (authButtons) {
                authButtons.innerHTML = '<p style="color: red;">Error: Configuraci√≥n de Firebase incompleta. Contacta al soporte.</p>';
            }
        });
    }

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);
    const auth = firebase.auth(app);

    // Exponer variables globales para main.js
    window.app = app;
    window.db = db;
    window.auth = auth;
    window.appId = appId;

    // Autenticaci√≥n inicial con token personalizado o an√≥nima
    window.currentUserId = null; // Inicialmente nulo

    // Manejar el estado de autenticaci√≥n
    firebase.auth().onAuthStateChanged(async (user) => {
        const userDisplay = document.getElementById('user-display');
        const authButtons = document.getElementById('auth-buttons');
        const userEmailSpan = document.getElementById('user-email');

        if (user) {
            window.currentUserId = user.uid;
            userEmailSpan.textContent = user.email || 'Usuario An√≥nimo';
            userDisplay.style.display = 'block';
            authButtons.style.display = 'none';
            console.log("Usuario autenticado:", user.uid);

            // Cargar datos del usuario solo si no estamos en proceso de cierre de sesi√≥n
            if (!window.isLoggingOut) {
                await window.loadAllUserData();
            }
        } else {
            window.currentUserId = null;
            userDisplay.style.display = 'none';
            authButtons.style.display = 'flex';
            console.log("Usuario no autenticado.");
            // Si no hay usuario, limpiar la UI o mostrar un estado predeterminado
            // Por ejemplo, ocultar las secciones de contenido o mostrar un mensaje
            document.querySelectorAll('.content-section').forEach(section => {
                if (section.id !== 'pomodoro') { // Mantener Pomodoro visible si es una secci√≥n p√∫blica
                    section.classList.remove('active');
                }
            });
             document.getElementById('pomodoro').classList.add('active'); // Asegurarse de que Pomodoro est√© activo
        }
    });

    // Funci√≥n de confirmaci√≥n personalizada
    window.customConfirm = (message) => {
        return new Promise((resolve) => {
            const modal = document.getElementById('custom-confirm-modal');
            const messageEl = document.getElementById('custom-confirm-message');
            const yesBtn = document.getElementById('custom-confirm-yes');
            const noBtn = document.getElementById('custom-confirm-no');

            messageEl.textContent = message;
            modal.style.display = 'flex'; // Make it visible (but still transparent/offset)

            // Force reflow to ensure display:flex is applied before adding 'show' class
            // This is crucial for CSS transitions to work from display:none to display:flex
            void modal.offsetWidth;

            modal.classList.add('show'); // Now add the class that applies opacity and transform

            const cleanup = () => {
                modal.classList.remove('show'); // Start hide transition
                // Wait for the transition to finish before setting display to 'none'
                modal.addEventListener('transitionend', () => {
                    modal.style.display = 'none';
                }, { once: true });
                yesBtn.removeEventListener('click', onYesClick);
                noBtn.removeEventListener('click', onNoClick);
            };

            const onYesClick = () => {
                cleanup();
                resolve(true);
            };

            const onNoClick = () => {
                cleanup();
                resolve(false);
            };

            yesBtn.addEventListener('click', onYesClick);
            noBtn.addEventListener('click', onNoClick);
        });
    };
  </script>

  <!-- main.js se carga al final del body para asegurar que todos los elementos HTML est√©n disponibles -->
  <script src="js/main.js"></script>
</body>
</html>
